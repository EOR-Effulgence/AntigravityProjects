# Marp x Antigravity: PPTX出力・高度デザイン手法ガイド

このドキュメントでは、Google Antigravity（AI）とMarp CLIを組み合わせて、高品質で「崩れない」PowerPointプレゼン資料を作成するための決定版ワークフローと技術手法を整理します。

---

## 1. デザインコンセプト：Markdownを「真理」としつつ、CSSで「枠」を固める

MarpでPPTXを出力する際、最も大きな課題は「HTML/CSSの柔軟なレイアウトが、PowerPointの固定的な枠組みと衝突する」ことです。これを解決するため、以下の3段階のワークフローを推奨します。

### ステップ1：プロンプトによるグラフィック生成
単なる図解ではなく、スライドのテーマに合わせた高品質な背景やイラストをAI（Antigravity）で生成します。
- **背景用:** `bg opacity:.2` で薄く敷くための抽象的なグラフィック
- **説明用:** アイソメトリック（等角投影）イラストなど、ビジネス感のある素材

### ステップ2：CSSマスターレイアウトの定義
スライドごとにレイアウトをいじるのではなく、Markdownの冒頭（Frontmatter）で「崩れない型」を定義します。

```css
style: |
  section {
    padding: 60px 80px; /* 人間の感覚にフィットする大きめの余白 */
    background: linear-gradient(...); /* 全スライド共通のベース背景 */
  }
  .grid-2col {
    display: grid;
    grid-template-columns: 65% 35%; /* 黄金比に近い比率で分割 */
    gap: 40px;
    align-items: center; /* 垂直方向も整列 */
  }
```

### ステップ3：不安定な要素の「静止画像化」
Mermaidのような動的描画ツールは、PPTX変換時に文字化けや描画失敗が起きやすいため、**「事前にPNG画像として書き出し、Markdownには画像を貼る」**のが最も堅牢な手法です。

---

## 2. 実践的なトラブル解決手法（Methodology）

これまで遭遇した問題とその「立て直し」手法をパターン化しました。

### パターンA：図解（Mermaid）が表示されない・崩れる
- **原因:** Marp CLIのPPTX変換エンジン（Playwright）とMermaidのレンダリングタイミングが合わない。
- **解消法:** 
  1. Mermaidコードを `.mmd` ファイル等に保存。
  2. `mmdc` (Mermaid CLI) やAI生成で **PNG画像化**。
  3. `![](images/diagram.png)` として埋め込む。

### パターンB：レイアウト崩れ・文字溢れ
- **原因:** `![bg right]` 等の特殊記法は、PowerPoint側で背景レイヤーとして扱われ、テキストと干渉しやすい。
- **解消法:**
  - `bg` 記法を多用せず、HTMLの `<div>` と CSS Grid で **「文章の箱」と「画像の箱」を論理的に分離** する。
  - `max-height` や `max-width` を画像に適用し、物理的に枠外に出ないように縛る。

### パターンC：感覚的な「バランスの悪さ」
- **原因:** デフォルトのPaddingが少なすぎる、または表が左に寄る等。
- **解消法:**
  - **padding:** 40px以下は危険。ビジネススライドでは 60px〜100px の余白を設ける。
  - **centering:** `table { margin: auto; }` で強制的に中央寄せ。
  - **grid ratio:** 1:1 分割ではなく、6:4 や 7:3 にすることで、情報の主従関係（文章が主、図が従）を明確にする。

---

## 3. 推奨出力コマンド
画像を確実に埋め込み、ローカル制限を回避するために以下のフラグを使用します。

```bash
npx -y @marp-team/marp-cli@latest slide.md -o output.pptx --allow-local-files
```

---

## 結論：安定性のためのチェックリスト

- [ ] **1. CSS Grid を使用しているか？** (bg記法に頼りすぎない)
- [ ] **2. 余白（Padding）は 60px 以上あるか？**
- [ ] **3. 複雑な図解は画像化済みか？**
- [ ] **4. 画像に `max-width: 95%` 等の制限をかけているか？**
- [ ] **5. 表は `margin: auto` で中央にあるか？**

このワークフローを遵守することで、AIが生成したドキュメントを「そのままプレゼンで使える」レベルのPPTXとして出力し続けることが可能になります。
