# テンプレートグラフ置換機能の仕様設計 (Design Chart Replacement)

## 背景
`python-pptx` の標準APIでは作成困難な「複合グラフ」や「高度にデザインされたグラフ」を、編集可能な状態で自動生成するために、**「テンプレート内のダミーグラフに対してデータを流し込む」**機能を実装する。

## 1. テンプレート側の準備
*   PowerPointテンプレート上に、最終形と同じ種類のグラフ（例：棒グラフ＋折れ線の2軸グラフ）を配置する。
*   グラフにはダミーデータを入れておく。
*   **重要**: グラフ（オブジェクト）に一意の識別名を付ける。
    *   PowerPointの「オブジェクトの選択と表示 (Selection Pane)」機能を使用。
    *   命名規則: `{{CHART_SALES_TRANSITION}}` のように、二重波括弧で囲んだIDをオブジェクト名に設定する。

## 2. JSONデータ構造の拡張
`slides` 配列内の各要素に、新たに `chart_replacements` フィールドを定義する。

```json
{
  "layout": "コンテンツ",
  "title": "2030年 売上・利益予測",
  "chart_replacements": [
    {
      "target_id": "{{CHART_SALES_TRANSITION}}",
      "data": {
        "categories": ["2020", "2021", "2022", "2023", "2024", "2025"],
        "series": [
          {
            "name": "売上高（左軸）",
            "values": [100, 120, 150, 180, 220, 300]
          },
          {
            "name": "営業利益率（右軸）",
            "values": [0.10, 0.12, 0.15, 0.14, 0.18, 0.20]
          }
        ]
      }
    }
  ]
}
```
※ 複合グラフの場合でも、データの流し込み自体は `CategoryChartData` などを通じて一括で行えるケースが多いが、シリーズの順序が重要になる。

## 3. 実装ロジック (`scripts/chart_utils.py` 拡張)

### 関数: `replace_chart_data(slide, target_id, chart_data)`
1.  スライド内の全シェイプを走査する。
2.  `shape.name` が `target_id` と一致するものを探す。
3.  見つかったシェイプがグラフ (`GraphicFrame` かつ `chart` プロパティを持つ) であることを確認。
4.  `chart.replace_data(chart_data)` メソッドを実行してデータを更新する。

### 考慮事項：複合グラフのデータ構造
*   複合グラフの場合、PowerPoint内部では1つのExcelシートで管理されている。
*   `python-pptx` の `replace_data` は、基本的にそのExcelデータを上書きする挙動となるため、シリーズの順番さえ合っていれば、棒グラフ部分と折れ線グラフ部分に正しくデータが適用されるはずである。
*   検証が必要：シリーズ数が変わった場合（ダミーは2本、実際は3本など）の挙動。基本的には更新されるが、スタイル（何色で表示するか、どの軸に割り当てるか）は自動割り当てまたはテンプレートの初期設定に依存する可能性がある。

## 4. 開発・検証ステップ
1.  **テンプレート作成**: 複合グラフを含んだテスト用PPTXを作成し、オブジェクト名をセットする。
2.  **スクリプト拡張**: `replace_chart_data` 関数を実装。
3.  **検証**: JSONを用意して実行し、複合グラフのデータが正しく書き換わっているか、かつ編集可能か（Excelが開けるか）を確認する。
