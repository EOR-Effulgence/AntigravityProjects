# Refactoring & Improvement Plan

## 1. Architecture & Code Structure (構造とモジュール化)
現在のスクリプト群は `scripts/` にフラットに置かれていますが、機能ごとに整理し、再利用性とメンテナンス性を高めます。

- **パッケージ化**: `src/` ディレクトリを作成し、`slide_generator` (PPTX生成), `markdown_parser` (MD解析), `ai_agent` (AI制御) のようにモジュールを分けます。
- **設定の分離**: フォント名やテンプレートパス、カラーパレットなどがコード内にハードコードされています。これを `config.yaml` などの設定ファイルに外出しし、テンプレート変更に強くします。

## 2. Robustness (堅牢性の向上)
- **Markdown解析の強化**: 現在の正規表現ベースの解析は、複雑なMarkdown（ネストしたリストや特殊文字）に弱いです。`markdown-it-py` などの専用ライブラリを導入し、解析精度を向上させます。
- **エラーハンドリング**: AI生成時の一時的なエラーや、不正なフォーマットの自動修正（例: JSONが壊れている場合のリカバリ）を強化します。
- **テスト自動化**: 数値データ（グラフ）の読み込みやMarkdown解析部分に単体テストを追加し、変更時のデグレードを防ぎます。

## 3. Feature Enhancements (機能拡張)
- **テーマカラー対応**: グラフの色をPowerPointテンプレートのテーマカラーに自動的に合わせる、または指定可能にします（現在はデフォルト色）。
- **テンプレート自動解析ツールの統合**: テンプレートファイルを差し替えた際、どのレイアウトが使用可能かを自動検出し、マッピング設定を補助するツールをパイプラインに組み込みます。
- **中間ファイル管理**: 生成した `proposal.md` や画像を、案件（トピック）ごとにフォルダ分けして管理する仕組みを作ります。

## 4. Immediate Refactoring Steps (推奨される次のアクション)
まず最初に取り組むべきは **「設定の分離とコード整理」** です。これにより、テンプレート変更への耐性がつき、今後の拡張の土台ができます。

### Phase 1: Configuration & Structure
1. `config/settings.yaml` の導入（フォント、テンプレートパス、デフォルトカラー設定）
2. `src/` へのコード移動とクラス化 (`SlideBuilder` クラスなど)

### Phase 2: Advanced Parsing
1. Markdownパーサーライブラリの導入
2. チャート種類の追加（積み上げ棒、折れ線+棒の複合グラフなど）
